let solarTerms = {
    "y2000": [
        "1/6",
        "1/21",
        "2/4",
        "2/19",
        "3/5",
        "3/20",
        "4/4",
        "4/20",
        "5/5",
        "5/21",
        "6/5",
        "6/21",
        "7/7",
        "7/22",
        "8/7",
        "8/23",
        "9/7",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/21"
    ],
    "y2001": [
        "1/5",
        "1/20",
        "2/4",
        "2/18",
        "3/5",
        "3/20",
        "4/5",
        "4/20",
        "5/5",
        "5/21",
        "6/5",
        "6/21",
        "7/7",
        "7/23",
        "8/7",
        "8/23",
        "9/7",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/22"
    ],
    "y2002": [
        "1/5",
        "1/20",
        "2/4",
        "2/19",
        "3/6",
        "3/21",
        "4/5",
        "4/20",
        "5/6",
        "5/21",
        "6/6",
        "6/21",
        "7/7",
        "7/23",
        "8/8",
        "8/23",
        "9/8",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/22"
    ],
    "y2003": [
        "1/6",
        "1/20",
        "2/4",
        "2/19",
        "3/6",
        "3/21",
        "4/5",
        "4/20",
        "5/6",
        "5/21",
        "6/6",
        "6/22",
        "7/7",
        "7/23",
        "8/8",
        "8/23",
        "9/8",
        "9/23",
        "10/9",
        "10/24",
        "11/8",
        "11/23",
        "12/7",
        "12/22"
    ],
    "y2004": [
        "1/6",
        "1/21",
        "2/4",
        "2/19",
        "3/5",
        "3/20",
        "4/4",
        "4/20",
        "5/5",
        "5/21",
        "6/5",
        "6/21",
        "7/7",
        "7/22",
        "8/7",
        "8/23",
        "9/7",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/21"
    ],
    "y2005": [
        "1/5",
        "1/20",
        "2/4",
        "2/18",
        "3/5",
        "3/20",
        "4/5",
        "4/20",
        "5/5",
        "5/21",
        "6/5",
        "6/21",
        "7/7",
        "7/23",
        "8/7",
        "8/23",
        "9/7",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/22"
    ],
    "y2006": [
        "1/5",
        "1/20",
        "2/4",
        "2/19",
        "3/6",
        "3/21",
        "4/5",
        "4/20",
        "5/5",
        "5/21",
        "6/6",
        "6/21",
        "7/7",
        "7/23",
        "8/7",
        "8/23",
        "9/8",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/22"
    ],
    "y2007": [
        "1/6",
        "1/20",
        "2/4",
        "2/19",
        "3/6",
        "3/21",
        "4/5",
        "4/20",
        "5/6",
        "5/21",
        "6/6",
        "6/22",
        "7/7",
        "7/23",
        "8/8",
        "8/23",
        "9/8",
        "9/23",
        "10/9",
        "10/24",
        "11/8",
        "11/23",
        "12/7",
        "12/22"
    ],
    "y2008": [
        "1/6",
        "1/21",
        "2/4",
        "2/19",
        "3/5",
        "3/20",
        "4/4",
        "4/20",
        "5/5",
        "5/21",
        "6/5",
        "6/21",
        "7/7",
        "7/22",
        "8/7",
        "8/23",
        "9/7",
        "9/22",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/21"
    ],
    "y2009": [
        "1/5",
        "1/20",
        "2/4",
        "2/18",
        "3/5",
        "3/20",
        "4/4",
        "4/20",
        "5/5",
        "5/21",
        "6/5",
        "6/21",
        "7/7",
        "7/23",
        "8/7",
        "8/23",
        "9/7",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/22"
    ],
    "y2010": [
        "1/5",
        "1/20",
        "2/4",
        "2/19",
        "3/6",
        "3/21",
        "4/5",
        "4/20",
        "5/5",
        "5/21",
        "6/6",
        "6/21",
        "7/7",
        "7/23",
        "8/7",
        "8/23",
        "9/8",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/22"
    ],
    "y2011": [
        "1/6",
        "1/20",
        "2/4",
        "2/19",
        "3/6",
        "3/21",
        "4/5",
        "4/20",
        "5/6",
        "5/21",
        "6/6",
        "6/22",
        "7/7",
        "7/23",
        "8/8",
        "8/23",
        "9/8",
        "9/23",
        "10/8",
        "10/24",
        "11/8",
        "11/23",
        "12/7",
        "12/22"
    ],
    "y2012": [
        "1/6",
        "1/21",
        "2/4",
        "2/19",
        "3/5",
        "3/20",
        "4/4",
        "4/20",
        "5/5",
        "5/20",
        "6/5",
        "6/21",
        "7/7",
        "7/22",
        "8/7",
        "8/23",
        "9/7",
        "9/22",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/21"
    ],
    "y2013": [
        "1/5",
        "1/20",
        "2/4",
        "2/18",
        "3/5",
        "3/20",
        "4/4",
        "4/20",
        "5/5",
        "5/21",
        "6/5",
        "6/21",
        "7/7",
        "7/22",
        "8/7",
        "8/23",
        "9/7",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/22"
    ],
    "y2014": [
        "1/5",
        "1/20",
        "2/4",
        "2/19",
        "3/6",
        "3/21",
        "4/5",
        "4/20",
        "5/5",
        "5/21",
        "6/6",
        "6/21",
        "7/7",
        "7/23",
        "8/7",
        "8/23",
        "9/8",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/22"
    ],
    "y2015": [
        "1/6",
        "1/20",
        "2/4",
        "2/19",
        "3/6",
        "3/21",
        "4/5",
        "4/20",
        "5/6",
        "5/21",
        "6/6",
        "6/22",
        "7/7",
        "7/23",
        "8/8",
        "8/23",
        "9/8",
        "9/23",
        "10/8",
        "10/24",
        "11/8",
        "11/22",
        "12/7",
        "12/22"
    ],
    "y2016": [
        "1/6",
        "1/20",
        "2/4",
        "2/19",
        "3/5",
        "3/20",
        "4/4",
        "4/19",
        "5/5",
        "5/20",
        "6/5",
        "6/21",
        "7/7",
        "7/22",
        "8/7",
        "8/23",
        "9/7",
        "9/22",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/21"
    ],
    "y2017": [
        "1/5",
        "1/20",
        "2/3",
        "2/18",
        "3/5",
        "3/20",
        "4/4",
        "4/20",
        "5/5",
        "5/21",
        "6/5",
        "6/21",
        "7/7",
        "7/22",
        "8/7",
        "8/23",
        "9/7",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/22"
    ],
    "y2018": [
        "1/5",
        "1/20",
        "2/4",
        "2/19",
        "3/5",
        "3/21",
        "4/5",
        "4/20",
        "5/5",
        "5/21",
        "6/6",
        "6/21",
        "7/7",
        "7/23",
        "8/7",
        "8/23",
        "9/8",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/22"
    ],
    "y2019": [
        "1/5",
        "1/20",
        "2/4",
        "2/19",
        "3/6",
        "3/21",
        "4/5",
        "4/20",
        "5/6",
        "5/21",
        "6/6",
        "6/21",
        "7/7",
        "7/23",
        "8/8",
        "8/23",
        "9/8",
        "9/23",
        "10/8",
        "10/24",
        "11/8",
        "11/22",
        "12/7",
        "12/22"
    ],
    "y2020": [
        "1/6",
        "1/20",
        "2/4",
        "2/19",
        "3/5",
        "3/20",
        "4/4",
        "4/19",
        "5/5",
        "5/20",
        "6/5",
        "6/21",
        "7/6",
        "7/22",
        "8/7",
        "8/22",
        "9/7",
        "9/22",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/21"
    ],
    "y2021": [
        "1/5",
        "1/20",
        "2/3",
        "2/18",
        "3/5",
        "3/20",
        "4/4",
        "4/20",
        "5/5",
        "5/21",
        "6/5",
        "6/21",
        "7/7",
        "7/22",
        "8/7",
        "8/23",
        "9/7",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/21"
    ],
    "y2022": [
        "1/5",
        "1/20",
        "2/4",
        "2/19",
        "3/5",
        "3/20",
        "4/5",
        "4/20",
        "5/5",
        "5/21",
        "6/6",
        "6/21",
        "7/7",
        "7/23",
        "8/7",
        "8/23",
        "9/7",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/22"
    ],
    "y2023": [
        "1/5",
        "1/20",
        "2/4",
        "2/19",
        "3/6",
        "3/21",
        "4/5",
        "4/20",
        "5/6",
        "5/21",
        "6/6",
        "6/21",
        "7/7",
        "7/23",
        "8/8",
        "8/23",
        "9/8",
        "9/23",
        "10/8",
        "10/24",
        "11/8",
        "11/22",
        "12/7",
        "12/22"
    ],
    "y2024": [
        "1/6",
        "1/20",
        "2/4",
        "2/19",
        "3/5",
        "3/20",
        "4/4",
        "4/19",
        "5/5",
        "5/20",
        "6/5",
        "6/21",
        "7/6",
        "7/22",
        "8/7",
        "8/22",
        "9/7",
        "9/22",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/6",
        "12/21"
    ],
    "y2025": [
        "1/5",
        "1/20",
        "2/3",
        "2/18",
        "3/5",
        "3/20",
        "4/4",
        "4/20",
        "5/5",
        "5/21",
        "6/5",
        "6/21",
        "7/7",
        "7/22",
        "8/7",
        "8/23",
        "9/7",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/21"
    ],
    "y2026": [
        "1/5",
        "1/20",
        "2/4",
        "2/18",
        "3/5",
        "3/20",
        "4/5",
        "4/20",
        "5/5",
        "5/21",
        "6/5",
        "6/21",
        "7/7",
        "7/23",
        "8/7",
        "8/23",
        "9/7",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/22"
    ],
    "y2027": [
        "1/5",
        "1/20",
        "2/4",
        "2/19",
        "3/6",
        "3/21",
        "4/5",
        "4/20",
        "5/6",
        "5/21",
        "6/6",
        "6/21",
        "7/7",
        "7/23",
        "8/8",
        "8/23",
        "9/8",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/22"
    ],
    "y2028": [
        "1/6",
        "1/20",
        "2/4",
        "2/19",
        "3/5",
        "3/20",
        "4/4",
        "4/19",
        "5/5",
        "5/20",
        "6/5",
        "6/21",
        "7/6",
        "7/22",
        "8/7",
        "8/22",
        "9/7",
        "9/22",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/6",
        "12/21"
    ],
    "y2029": [
        "1/5",
        "1/20",
        "2/3",
        "2/18",
        "3/5",
        "3/20",
        "4/4",
        "4/20",
        "5/5",
        "5/21",
        "6/5",
        "6/21",
        "7/7",
        "7/22",
        "8/7",
        "8/23",
        "9/7",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/21"
    ],
    "y2030": [
        "1/5",
        "1/20",
        "2/4",
        "2/18",
        "3/5",
        "3/20",
        "4/5",
        "4/20",
        "5/5",
        "5/21",
        "6/5",
        "6/21",
        "7/7",
        "7/23",
        "8/7",
        "8/23",
        "9/7",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/22"
    ],
    "y2031": [
        "1/5",
        "1/20",
        "2/4",
        "2/19",
        "3/6",
        "3/21",
        "4/5",
        "4/20",
        "5/6",
        "5/21",
        "6/6",
        "6/21",
        "7/7",
        "7/23",
        "8/8",
        "8/23",
        "9/8",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/22"
    ],
    "y2032": [
        "1/6",
        "1/20",
        "2/4",
        "2/19",
        "3/5",
        "3/20",
        "4/4",
        "4/19",
        "5/5",
        "5/20",
        "6/5",
        "6/21",
        "7/6",
        "7/22",
        "8/7",
        "8/22",
        "9/7",
        "9/22",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/6",
        "12/21"
    ],
    "y2033": [
        "1/5",
        "1/20",
        "2/3",
        "2/18",
        "3/5",
        "3/20",
        "4/4",
        "4/20",
        "5/5",
        "5/21",
        "6/5",
        "6/21",
        "7/7",
        "7/22",
        "8/7",
        "8/23",
        "9/7",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/21"
    ],
    "y2034": [
        "1/5",
        "1/20",
        "2/4",
        "2/18",
        "3/5",
        "3/20",
        "4/5",
        "4/20",
        "5/5",
        "5/21",
        "6/5",
        "6/21",
        "7/7",
        "7/23",
        "8/7",
        "8/23",
        "9/7",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/22"
    ],
    "y2035": [
        "1/5",
        "1/20",
        "2/4",
        "2/19",
        "3/6",
        "3/21",
        "4/5",
        "4/20",
        "5/5",
        "5/21",
        "6/6",
        "6/21",
        "7/7",
        "7/23",
        "8/7",
        "8/23",
        "9/8",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/22"
    ],
    "y2036": [
        "1/6",
        "1/20",
        "2/4",
        "2/19",
        "3/5",
        "3/20",
        "4/4",
        "4/19",
        "5/5",
        "5/20",
        "6/5",
        "6/21",
        "7/6",
        "7/22",
        "8/7",
        "8/22",
        "9/7",
        "9/22",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/6",
        "12/21"
    ],
    "y2037": [
        "1/5",
        "1/20",
        "2/3",
        "2/18",
        "3/5",
        "3/20",
        "4/4",
        "4/20",
        "5/5",
        "5/21",
        "6/5",
        "6/21",
        "7/7",
        "7/22",
        "8/7",
        "8/23",
        "9/7",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/21"
    ],
    "y2038": [
        "1/5",
        "1/20",
        "2/4",
        "2/18",
        "3/5",
        "3/20",
        "4/5",
        "4/20",
        "5/5",
        "5/21",
        "6/5",
        "6/21",
        "7/7",
        "7/23",
        "8/7",
        "8/23",
        "9/7",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/22"
    ],
    "y2039": [
        "1/5",
        "1/20",
        "2/4",
        "2/19",
        "3/6",
        "3/21",
        "4/5",
        "4/20",
        "5/5",
        "5/21",
        "6/6",
        "6/21",
        "7/7",
        "7/23",
        "8/7",
        "8/23",
        "9/8",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/22"
    ],
    "y2040": [
        "1/6",
        "1/20",
        "2/4",
        "2/19",
        "3/5",
        "3/20",
        "4/4",
        "4/19",
        "5/5",
        "5/20",
        "6/5",
        "6/21",
        "7/6",
        "7/22",
        "8/7",
        "8/22",
        "9/7",
        "9/22",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/6",
        "12/21"
    ],
    "y2041": [
        "1/5",
        "1/20",
        "2/3",
        "2/18",
        "3/5",
        "3/20",
        "4/4",
        "4/20",
        "5/5",
        "5/20",
        "6/5",
        "6/21",
        "7/7",
        "7/22",
        "8/7",
        "8/23",
        "9/7",
        "9/22",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/21"
    ],
    "y2042": [
        "1/5",
        "1/20",
        "2/4",
        "2/18",
        "3/5",
        "3/20",
        "4/4",
        "4/20",
        "5/5",
        "5/21",
        "6/5",
        "6/21",
        "7/7",
        "7/23",
        "8/7",
        "8/23",
        "9/7",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/22"
    ],
    "y2043": [
        "1/5",
        "1/20",
        "2/4",
        "2/19",
        "3/6",
        "3/21",
        "4/5",
        "4/20",
        "5/5",
        "5/21",
        "6/6",
        "6/21",
        "7/7",
        "7/23",
        "8/7",
        "8/23",
        "9/8",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/22"
    ],
    "y2044": [
        "1/6",
        "1/20",
        "2/4",
        "2/19",
        "3/5",
        "3/20",
        "4/4",
        "4/19",
        "5/5",
        "5/20",
        "6/5",
        "6/21",
        "7/6",
        "7/22",
        "8/7",
        "8/22",
        "9/7",
        "9/22",
        "10/7",
        "10/23",
        "11/7",
        "11/22",
        "12/6",
        "12/21"
    ],
    "y2045": [
        "1/5",
        "1/20",
        "2/3",
        "2/18",
        "3/5",
        "3/20",
        "4/4",
        "4/19",
        "5/5",
        "5/20",
        "6/5",
        "6/21",
        "7/7",
        "7/22",
        "8/7",
        "8/23",
        "9/7",
        "9/22",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/21"
    ],
    "y2046": [
        "1/5",
        "1/20",
        "2/4",
        "2/18",
        "3/5",
        "3/20",
        "4/4",
        "4/20",
        "5/5",
        "5/21",
        "6/5",
        "6/21",
        "7/7",
        "7/22",
        "8/7",
        "8/23",
        "9/7",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/22"
    ],
    "y2047": [
        "1/5",
        "1/20",
        "2/4",
        "2/19",
        "3/6",
        "3/21",
        "4/5",
        "4/20",
        "5/5",
        "5/21",
        "6/6",
        "6/21",
        "7/7",
        "7/23",
        "8/7",
        "8/23",
        "9/8",
        "9/23",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/22"
    ],
    "y2048": [
        "1/6",
        "1/20",
        "2/4",
        "2/19",
        "3/5",
        "3/20",
        "4/4",
        "4/19",
        "5/5",
        "5/20",
        "6/5",
        "6/20",
        "7/6",
        "7/22",
        "8/7",
        "8/22",
        "9/7",
        "9/22",
        "10/7",
        "10/23",
        "11/7",
        "11/21",
        "12/6",
        "12/21"
    ],
    "y2049": [
        "1/5",
        "1/19",
        "2/3",
        "2/18",
        "3/5",
        "3/20",
        "4/4",
        "4/19",
        "5/5",
        "5/20",
        "6/5",
        "6/21",
        "7/6",
        "7/22",
        "8/7",
        "8/22",
        "9/7",
        "9/22",
        "10/8",
        "10/23",
        "11/7",
        "11/22",
        "12/7",
        "12/21"
    ]
};

/**
 * 計算日期
 * 
 * @param {number} y 
 * @param {number} m 
 * @param {number} d 
 * @param {number} diffDays 
 * @returns {Array<number>}
 */
function calcDate(y, m, d, diffDays) {
    let date = new Date(`${y}/${m}/${d}`);
    date.setDate(date.getDate() + diffDays);

    let yyyy = date.getFullYear();
    let MM = `0${date.getMonth()+1}`.substr(-2);
    let dd = `0${date.getDate()}`.substr(-2);
    let result = [yyyy, MM, dd];

    return result;
}

/**
 * 取得干支記日
 * 
 * @param {number} y 
 * @param {number} m 
 * @param {number} d 
 * @returns 
 */
function getCycle(y, m, d) {
    // 2020/01/01, 干支記日循環的序號減一
    let startCycle = 54;

    m = ("0" + m).substr(-2);
    d = ("0" + d).substr(-2);

    let date1 = new Date(`2000/01/01`);
    let date2 = new Date(`${y}/${m}/${d}`);

    let deltaTime = date2.getTime() - date1.getTime();
    let deltaDays = deltaTime / (1000 * 3600 * 24);
    let cycle = (startCycle + deltaDays) % 60;

    return cycle;
}

/**
 * 取得干支記法
 * 
 * @param {number} cycle 
 * @returns {string}
 */
function getStem(cycle) {
    let heavenlyStems = ["甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"];
    let earthlyBranches = ["子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"];
    cycle = (cycle + 6000000) % 60;

    return heavenlyStems[cycle % 10] + earthlyBranches[cycle % 12];
}


/**
 * 取得九宮飛星對應文字
 * 
 * @param {number} cycle 
 * @returns {string}
 */
function getStar(cycle) {
    let stars = ["一白", "二黑", "三碧", "四綠", "五黃", "六白", "七赤", "八白", "九紫"];
    cycle = (cycle + 900000) % 9;

    return stars[cycle];
}

/**
 * 取得九宮飛星對應事項
 * 
 * @param {number} cycle 
 * @returns {string}
 */
function getStatus(cycle) {
    let status = ["事業", "病魔", "爭鬥", "文昌", "災難", "權力", "是非", "財源", "喜樂"];
    cycle = (cycle + 900000) % 9;

    return status[cycle];
}

/**
 * 取得指定年份的節氣對應日期
 *  - 雨水: 1
 *  - 穀雨: 2
 *  - 夏至: 3
 *  - 處暑: 4
 *  - 霜降: 5
 *  - 冬至: 6
 * 
 * @param {number} year 
 * @param {number} termType 
 * @returns {Array<number>} [month, day]
 */
function getTermDate(year, termType = 1) {
    return solarTerms[`y${year}`][4 * termType - 1].split("/");
}

/**
 * 取得九宮飛星盤
 * 
 * @param {number} center - 中宮數字
 * @param {boolean} positive - 是否順飛
 * @returns {Array<number>}
 */
function getTable(center = 1, positive = true) {
    let pTable = [
        [4, 9, 2],
        [3, 5, 7],
        [8, 1, 6]
    ];

    let nTable = [
        [6, 1, 8],
        [7, 5, 3],
        [2, 9, 4]
    ];

    let table = [
        [0, 0, 0],
        [0, 0, 0],
        [0, 0, 0]
    ];

    if (positive) {
        let diff = center - 5 - 1;

        for (let i = 0; i < 3; i++) {
            for (let j = 0; j < 3; j++) {
                let number = (9 + pTable[i][j] + diff) % 9;
                table[i][j] = number + 1;
            }
        }
    } else {
        let diff = center - 5 - 1;

        for (let i = 0; i < 3; i++) {
            for (let j = 0; j < 3; j++) {
                let number = (9 + nTable[i][j] + diff) % 9;
                table[i][j] = number + 1;
            }
        }
    }


    return table.flat();
}

/**
 * 取得兩個日期相差日數（Date1 - Date2）
 * 
 * @param {number} y1 
 * @param {number} m1 
 * @param {number} d1 
 * @param {number} y2 
 * @param {number} m2 
 * @param {number} d2 
 * @returns {number}
 */
function compareDate(y1, m1, d1, y2, m2, d2) {
    m1 = ("0" + m1).substr(-2);
    d1 = ("0" + d1).substr(-2);
    m2 = ("0" + m2).substr(-2);
    d2 = ("0" + d2).substr(-2);

    let date1 = new Date(`${y1}/${m1}/${d1}`);
    let date2 = new Date(`${y2}/${m2}/${d2}`);

    let deltaTime = date1.getTime() - date2.getTime();
    let deltaDays = deltaTime / (1000 * 3600 * 24);

    return deltaDays;
}

function init() {
    let d = new Date();
    let yyyy = d.getFullYear();
    let MM = `0${d.getMonth()+1}`.substr(-2);
    let dd = `0${d.getDate()}`.substr(-2);
    let result = `${yyyy}-${MM}-${dd}`;

    document.querySelector("#date").value = result;

    update(...result.split("-"));
}

function update(yyyy, mm, dd) {
    let directions = ["東南", "南", "西南", "東", "", "西", "東北", "北", "西北"];
    let terms = ["", "雨水", "穀雨", "夏至", "處暑", "霜降", "冬至"];
    let stars = ["", "七赤", "四綠", "九紫", "三碧", "六白", "一白"];
    let starsNum = [0, 7, 4, 9, 3, 6, 1];
    let closestTerm;
    let closestTermDate;
    let deltaDays;
    let target;
    let positive = true;

    // 向前取得最接近的節氣
    for (let i = 1; i <= 6; i++) {
        let term = getTermDate(yyyy, i);
        let diff = compareDate(yyyy, mm, dd, yyyy, term[0], term[1]);

        if (diff < 0) {
            if (i == 1) {
                closestTerm = 6;
                closestTermDate = getTermDate(yyyy - 1, 6);
                deltaDays = compareDate(yyyy, mm, dd, yyyy - 1, closestTermDate[0], closestTermDate[1]);
            }

            console.log(closestTermDate, deltaDays);
            break;
        }

        closestTerm = i;
        closestTermDate = term;
        deltaDays = diff;

        if ([3, 4, 5].includes(i)) {
            positive = false;
        } else {
            positive = true;
        }
    }

    // 取得干支編號
    let cycle = getCycle(yyyy, mm, dd);
    let stem = getStem(cycle);

    if (cycle > deltaDays) {
        target = calcDate(yyyy, mm, dd, 60 - cycle);
    } else {
        target = calcDate(yyyy, mm, dd, -cycle);
    }

    // 填入選擇日期的詳細資訊
    document.querySelector("#selectedDate").innerHTML = `
    <br>
    <ul>
        <li>西元 ${yyyy} 年 ${mm} 月 ${dd} 日 </li>
        <li>日干支：${stem} (${cycle})</li>
        <li>最接近節氣：${terms[closestTerm]} (${closestTermDate[0]}/${closestTermDate[1]})</li>
        <li>上述節氣後第一個甲子日：${target.join(".")}</li>
        <li>上述九宮飛星：${positive? "順飛" : "逆飛"}，${stars[closestTerm]}星入中宮</li>
    </ul>
    `;

    // 計算九宮飛星
    let centerStar;
    if (positive) {
        centerStar = (starsNum[closestTerm] + deltaDays) % 9;
    } else {
        centerStar = (starsNum[closestTerm] - deltaDays) % 9;
    }

    let table = getTable(centerStar, positive);

    // 0 1 2
    // 3 4 5
    // 6 7 8
    let tds = [...document.querySelectorAll("#starTable td")];
    let tStars = table.map(each => getStar(each - 1));
    let tStatus = table.map(each => getStatus(each - 1));

    // 填入九宮飛星
    for (let i = 0; i < 9; i++) {
        tds[i].innerHTML = `
            <div class="background">${directions[i]}</div>
            <div class="black">${tStars[i]}</div>
            <div class="green">${tStatus[i]}</div>
        `;
    }


}

init();

document.querySelector("#date").onchange = e => {
    e.stopPropagation();

    let value = e.target.value;
    update(...value.split("-"));
}